drop view if exists v_subject_group_2;
create view v_subject_group_2 as
select s.subject_name,
 case c.group_type_id 
    when 0 then 'весь класс' 
    when 1 then 'м./д.' 
    when 2 then 'группы'
    end 
 as group_type,
 case a.group_id
   when 1 then case c.group_type_id when 1 then 'М' end
   when 2 then case c.group_type_id when 1 then 'Д' end
 end as group_no,
 t.last_name || ' ' || substr(t.first_name,1,1) || '. ' || substr(t.patronymic,1,1) || '.' as teacher,
 r.name as room ,  
 g.caption as building,
 
 a.*,b.curriculum_id,c.*

 from subject_group a inner join depart b on a.depart_id=b.id
 inner join curriculum_detail c on c.curriculum_id=b.curriculum_id
 and c.subject_id=a.subject_id
 inner join subject s on s.id=a.subject_id
 left join teacher t on t.id = a.default_teacher_id
 left join room r on r.id = a.default_room_id
 left join building g on g.id = r.building_id
;

select * from v_subject_group_2;